name: ci

permissions: {} # No default permissions.

on:
  push:
    branches:
      - "**" # All branches
    tags:
      - v[0-9]+.[0-9]+.[0-9]+ # Release tags, e.g. v0.1.2
  pull_request:
    branches:
      - master
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  FORCE_COLOR: "1" # Make tools pretty.

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v5
        with:
          persist-credentials: false

      - name: Setup uv
        uses: astral-sh/setup-uv@v6

      - name: Run Bootstrap.ps1
        shell: pwsh
        run: ./scripts/Bootstrap.ps1

      - name: Dry run Release-Project.ps1
        # Release-Project fails if not eun from the master branch.
        if: (github.ref == 'refs/heads/master')
        shell: pwsh
        run: ./scripts/Release-Project.ps1 -Bump patch -DryRun
